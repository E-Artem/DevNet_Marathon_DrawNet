# DevNet_Marathon_DrawNet

**DevNet Марафон Финал**

**Исходная информация:**  
Имеется сеть, состоящая из различных L2/L3 сетевых устройств под управлением IOS/IOSXE. 
Известен список IP-адресов управления для всех устройств, все устройства доступны по IP, для каждого устройства есть доступ для выполнения show-команд. 
Для вас доступны любые способы сбора информации, но поверьте, вам вряд ли нужен SNMP. 
Хотя мы не в праве ограничивать вашу фантазию. 

**Основная задача:**  
определить физическую топологию соединений устройств по LLDP и визуализировать ее в удобном для восприятия человеком виде (да, нам всем удобны графические схемы).
Выбрать формат хранения данных о топологии в удобном для машинного анализа виде (да, машинам неудобны графические схемы).
На рисунке c топологией должны быть отображены: 
- Пиктограмма каждого устройства (коммутаторы и маршрутизаторы могут быть отмечены одинаковым типом пиктограммы).
- Hostname устройства.
- Название каждого интерфейса (можно в сокращённом формате, например, вместо GigabitEthernet0/0 -G0/0).

Допускается реализация фильтров, ограничивающих (скрывающих) информацию. Дополнительная задача: определить изменения в топологии (сравнив текущую и предыдущую версии) и визуализировать их в удобном для восприятия человеком виде.
Tips: для сравнения версий топологии их хорошо было бы сохранять.

--------------------------------------------------------------------------------------------

**Скрипт:**  
- DrawNet.py

**Требования к системе:**  
Для работы должен быть установлен Graphviz (для Windows путь до файла dot.exe включен в PATH).  
Дополнительные пакеты pip: nornir, graphviz  

**Входные данные:**  
- в файлах hosts.yaml и groups.yaml в папке .\inventory задается nornir-топология (данные для подключения к устройствам)

**Выходные данные:**
- в консоль выводится отчет о разборе данных вывода show-команд с устройств
- выводится информация о создании элементов структур узлов ("New Node") c детальной информацией о каждом
- выводится информация о создании элементов структур связей ("New Links") с детальной информацией о связях
- текущая топология записываетя в формате .yaml в папку .\schemas в файл topology_yyyymmdd-hhmmss.yaml
- записываетя текущая визуализация топологии в формате .svg в папку .\schemas 
- проводится анализ текущей топологии с предыдущей (на основе разбора структур yaml-файлов)
- в случае наличия изменений текущей топологи с предыдущей - в консоль выводятся сведения об изменении конкретных узлов и связей
- формат вывода в консоль при двух последовательных запусках (с изменением топологии - появляется устойство ISR 4451) - детально отражен в файлах _output1.txt, _output2.txt в папке schemas

**Особенности:**
- анализируются не только связи между устройствами из файла hosts.yaml, а все доступные связи с этих устройствам по lldp с внесением и отображением в топологии
- корректно разбираются варианты устройств с несколькими узлами (например, коммутаторов ядра)
- корректно отображаются данные о sub-интерфейсах
- на основе lldp-данных о возможностях устройств ('capabilities') выбираются корректные пиктограммы (коммутатор, маршрутизатор, телефон и т.д.)

**Приложение 1 (пример обнаружения изменения топологи, приведенный в _output2.txt)**

-----

```Previous topology file: 'topology_20200506-034913.yaml'  
Current topology file : 'topology_20200506-040329.yaml'  
Analyzing current topology vs previous:  
 new device: 'LLDP_d4c93c4b9840'  
 new link:   
  device 'T9D-ACC1' port 'Gi1/0/20'  
  device 'rtr_4451' port 'Gi0/0/0.441'  
 new link:   
  device 'T9D-ACC1' port 'Gi1/0/20'  
  device 'rtr_4451' port 'Gi0/0/0'

Rendering file 'topology_20200506-040329'
```
-----
